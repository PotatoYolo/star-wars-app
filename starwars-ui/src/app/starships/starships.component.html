<div class="starships-container">
  <span class="glyph-symbol-special">@</span>
  <h2>Starships</h2>

  <input
    type="text"
    [(ngModel)]="search"
    (ngModelChange)="onSearchChange()"
    placeholder="Search by name..."
  />

  @if (isLoading) {
    <div class="loading">Loading...</div>
  }

  @if (hasError) {
    <div class="error">{{ errorMessage }}</div>
  }

  @if (isEmpty && !isLoading && !hasError) {
    <div class="empty">No starships found.</div>
  }

  @if (!isLoading && !hasError && !isEmpty) {
    <table>
      <thead>
      <tr>
        <th
          tabindex="0"
          (click)="changeSort('name')"
          (keydown.enter)="changeSort('name')"
          (keydown.space)="changeSort('name')">
          Name
          @if (sort === 'name,asc') {
            <span class="arrow">▲</span>
          } @else if (sort === 'name,desc') {
            <span class="arrow">▼</span>
          } @else {
            <span class="arrow">▲▼</span>
          }
        </th>
        <th>Model</th>
        <th>Manufacturer</th>
        <th>Starship Class</th>
        <th>Crew</th>
        <th>Cost in Credits</th>
        <th>Info</th>
      </tr>
      </thead>
      <tbody>
        @for (starship of starships; track starship) {
          <tr>
            <td>{{ starship.name }}</td>
            <td
              class="clamp"
              [attr.data-full]="starship.model">
              {{ starship.model }}
            </td>
            <td
              class="clamp"
              [attr.data-full]="starship.manufacturer">
              {{ starship.manufacturer }}
            </td>
            <td>{{ starship.starship_class }}</td>
            <td>{{ starship.crew }}</td>
            <td>{{ starship.cost_in_credits }}</td>
            <td>
              <button (click)="openModal(starship)" class="material-icon-btn" title="More info">
                <span class="material-icons">visibility</span>
              </button>
            </td>
          </tr>
        }
      </tbody>
    </table>

    <div class="pagination">
      <button (click)="prevPage()" [disabled]="page === 0">Previous</button>

      <div class="pages">
        @for (p of pages; track p) {
          @if (p === -1) {
            <span class="dots">…</span>
          } @else {
            <button class="page-btn" [class.active]="p === page" (click)="goToPage(p)">
              {{ p + 1 }}
            </button>
          }
        }
      </div>

      <button (click)="nextPage()" [disabled]="page + 1 >= totalPages">Next</button>
    </div>

  }

  <div class="back-button-container">
    <button routerLink="/" class="back-btn">← Back to Home</button>
  </div>


  @if (selectedStarship) {
    <div class="modal">
      <div class="modal-content compact">
        <h3>{{ selectedStarship.name }}</h3>

        <div class="grid">
          <p><strong>Model:</strong> {{ selectedStarship.model }}</p>
          <p><strong>Manufacturer:</strong> {{ selectedStarship.manufacturer }}</p>
          <p><strong>Cost:</strong> {{ selectedStarship.cost_in_credits }}</p>
          <p><strong>Length:</strong> {{ selectedStarship.length }}</p>
          <p><strong>Crew:</strong> {{ selectedStarship.crew }}</p>
          <p><strong>Passengers:</strong> {{ selectedStarship.passengers }}</p>
          <p><strong>Class:</strong> {{ selectedStarship.starship_class }}</p>
          <p><strong>Hyperdrive Rating:</strong> {{ selectedStarship.hyperdrive_rating }}</p>
          <p><strong>MGLT:</strong> {{ selectedStarship.MGLT }}</p>
        </div>

        <div class="extra">
          <p><strong>Films:</strong> {{ selectedStarship.films.join(', ') }}</p>
          <p><strong>Pilots:</strong> {{ selectedStarship.pilots.length ? selectedStarship.pilots.join(', ') : 'None' }}</p>
        </div>

        <button (click)="closeModal()">Close</button>
      </div>
    </div>
  }

</div>
