<div class="species-container">
  <span class="glyph-symbol-special">@</span>
  <h2>Species</h2>

  <input
    type="text"
    [(ngModel)]="search"
    (ngModelChange)="onSearchChange()"
    placeholder="Search by name..."
  />

  @if (isLoading) {
    <div class="loading">Loading...</div>
  }

  @if (hasError) {
    <div class="error">{{ errorMessage }}</div>
  }

  @if (isEmpty && !isLoading && !hasError) {
    <div class="empty">No species found.</div>
  }

  @if (!isLoading && !hasError && !isEmpty) {
    <table>
      <thead>
      <tr>
        <th
          tabindex="0"
          (click)="changeSort('name')"
          (keydown.enter)="changeSort('name')"
          (keydown.space)="changeSort('name')">
          Name
          @if (sort === 'name,asc') {
            <span class="arrow">▲</span>
          } @else if (sort === 'name,desc') {
            <span class="arrow">▼</span>
          } @else {
            <span class="arrow">▲▼</span>
          }
        </th>
        <th>Classification</th>
        <th>Designation</th>
        <th>Language</th>
        <th>Homeworld</th>
        <th>Info</th>
      </tr>
      </thead>
      <tbody>
        @for (species of speciesList; track species) {
          <tr>
            <td>{{ species.name }}</td>
            <td>{{ species.classification }}</td>
            <td>{{ species.designation }}</td>
            <td>{{ species.language }}</td>
            <td>{{ species.homeworld }}</td>
            <td>
              <button (click)="openModal(species)" class="material-icon-btn" title="More info">
                <span class="material-icons">visibility</span>
              </button>
            </td>
          </tr>
        }
      </tbody>
    </table>

    <div class="pagination">
      <button (click)="prevPage()" [disabled]="page === 0">Previous</button>

      <div class="pages">
        @for (p of pages; track p) {
          @if (p === -1) {
            <span class="dots">…</span>
          } @else {
            <button class="page-btn" [class.active]="p === page" (click)="goToPage(p)">
              {{ p + 1 }}
            </button>
          }
        }
      </div>

      <button (click)="nextPage()" [disabled]="page + 1 >= totalPages">Next</button>
    </div>

  }

  <div class="back-button-container">
    <button routerLink="/" class="back-btn">← Back to Home</button>
  </div>

  @if (selectedSpecies) {
    <div class="modal">
      <div class="modal-content compact">
        <h3 class="vehicle-title">{{ selectedSpecies.name }}</h3>

        <div class="grid">
          <p><strong>Classification:</strong> {{ selectedSpecies.classification }}</p>
          <p><strong>Designation:</strong> {{ selectedSpecies.designation }}</p>
          <p><strong>Average Height:</strong> {{ selectedSpecies.average_height }}</p>
          <p><strong>Skin Colors:</strong> {{ selectedSpecies.skin_colors }}</p>
          <p><strong>Hair Colors:</strong> {{ selectedSpecies.hair_colors }}</p>
          <p><strong>Eye Colors:</strong> {{ selectedSpecies.eye_colors }}</p>
          <p><strong>Average Lifespan:</strong> {{ selectedSpecies.average_lifespan }}</p>
          <p><strong>Language:</strong> {{ selectedSpecies.language }}</p>
        </div>

        <div class="extra">
          <p><strong>Homeworld:</strong> {{ selectedSpecies.homeworld || 'Unknown' }}</p>
          <p><strong>Films:</strong> {{ selectedSpecies.films.join(', ') || 'None' }}</p>
          <p><strong>People:</strong> {{ selectedSpecies.people.join(', ') || 'None' }}</p>
        </div>

        <button (click)="closeModal()">Close</button>
      </div>
    </div>
  }
</div>
